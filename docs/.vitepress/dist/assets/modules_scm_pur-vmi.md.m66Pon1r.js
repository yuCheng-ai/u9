import{_ as r,c as t,o as e,ae as a}from"./chunks/framework.CDjunVez.js";const h=JSON.parse('{"title":"VMI 业务管理 (VMI) - 开发者详尽指南","description":"","frontmatter":{},"headers":[],"relativePath":"modules/scm/pur-vmi.md","filePath":"modules/scm/pur-vmi.md"}'),n={name:"modules/scm/pur-vmi.md"};function i(l,o,s,c,g,d){return e(),t("div",null,[...o[0]||(o[0]=[a('<h1 id="vmi-业务管理-vmi-开发者详尽指南" tabindex="-1">VMI 业务管理 (VMI) - 开发者详尽指南 <a class="header-anchor" href="#vmi-业务管理-vmi-开发者详尽指南" aria-label="Permalink to &quot;VMI 业务管理 (VMI) - 开发者详尽指南&quot;">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>VMI（Vendor Managed Inventory）在采购端体现为**“先用后付”<strong>。开发者必须理解：这不仅是单据的堆叠，更是对</strong>结算时点、结算价格、差异对账**的精密控制。</p><hr><h2 id="_1-vmi-协议与规则定义-vmi-agreement" tabindex="-1">1. VMI 协议与规则定义 (VMI Agreement) <a class="header-anchor" href="#_1-vmi-协议与规则定义-vmi-agreement" aria-label="Permalink to &quot;1. VMI 协议与规则定义 (VMI Agreement)&quot;">​</a></h2><h3 id="企业痛点" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p><strong>“同样的料，有些供应商要求入库 30 天后必须结算，有些是领用就结，开发者如果写死了逻辑，合同就没法执行”</strong>。</p><h3 id="开发逻辑点" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>多维结算策略 (Settlement Policy)</strong>: <ul><li>开发者需在 VMI 协议中设计 <code>Trigger_Type</code> 字段。</li><li><strong>PG 实现建议</strong>: 使用 <strong>JSONB</strong> 存储复杂的协议规则（如：阶梯式库龄结算、特定日期范围的优惠策略），利用其灵活性应对多变的商务合同。</li></ul></li><li><strong>价格快照</strong>: <ul><li>VMI 结算价格是按“到货时”还是“结算时”？</li><li><strong>PG 实现建议</strong>: 利用 PostgreSQL 的 <strong><code>numeric</code></strong> 类型确保存储的价格快照具有极高的精度，并使用 <strong><code>daterange</code></strong> 管理协议价格的有效期。</li></ul></li></ul><hr><h2 id="_2-自动消耗与补账引擎-consumption-engine" tabindex="-1">2. 自动消耗与补账引擎 (Consumption Engine) <a class="header-anchor" href="#_2-自动消耗与补账引擎-consumption-engine" aria-label="Permalink to &quot;2. 自动消耗与补账引擎 (Consumption Engine)&quot;">​</a></h2><h3 id="企业痛点-1" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点-1" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p>“车间领了 5 个螺丝，我得手动去开采购单、入库单、报账单，一天干几百次，要累死人”。</p><h3 id="开发逻辑点-1" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点-1" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>后台补单任务 (Auto-Fulfillment)</strong>: <ul><li>开发者需实现一个监听 <code>WIP_Issue</code> 事件的处理器。</li><li><strong>PG 实现建议</strong>: 利用 PostgreSQL 的 <strong><code>NOTIFY / LISTEN</code></strong> 或 <strong>逻辑解码 (Logical Decoding)</strong> 机制。当领料事务提交时，自动触发异步补单进程，避免阻塞主业务流程。</li></ul></li><li><strong>事务一致性</strong>: <ul><li>开发者必须确保领料出库与 VMI 补账的一致性。</li><li><strong>PG 实现建议</strong>: 使用 <strong>两阶段提交 (2PC)</strong> 或将关联操作封装在同一个 <strong>数据库事务 (Transaction)</strong> 中，利用 <strong><code>SAVEPOINT</code></strong> 实现精细化的部分失败回滚。</li></ul></li></ul><hr><h2 id="_3-vmi-对账与红字冲销-reconciliation" tabindex="-1">3. VMI 对账与红字冲销 (Reconciliation) <a class="header-anchor" href="#_3-vmi-对账与红字冲销-reconciliation" aria-label="Permalink to &quot;3. VMI 对账与红字冲销 (Reconciliation)&quot;">​</a></h2><h3 id="企业痛点-2" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点-2" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p><strong>“退货时麻烦大了，VMI 已经结过账的货要退回供应商，怎么冲账？”</strong>。</p><h3 id="开发逻辑点-2" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点-2" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>红字关联逻辑</strong>: <ul><li>开发者需实现 <code>VMI_Return_Process</code>。</li><li><strong>PG 实现建议</strong>: 使用 <strong><code>UUID</code></strong> 或 <strong>递归 CTE</strong> 建立原单与红字单之间的深层关联链条，确保在复杂的多次部分退货场景下，依然能准确计算剩余可退额度。</li></ul></li><li><strong>差异调整</strong>: <ul><li>开发者需提供 <code>VMI_Price_Adjustment</code> 接口。</li><li><strong>PG 实现建议</strong>: 利用 <strong>窗口函数 (Window Functions)</strong> 快速对比协议调价前后的所有未结算行，并批量生成补差单据。</li></ul></li></ul><hr><h2 id="_4-供应商协同看板-supplier-portal" tabindex="-1">4. 供应商协同看板 (Supplier Portal) <a class="header-anchor" href="#_4-供应商协同看板-supplier-portal" aria-label="Permalink to &quot;4. 供应商协同看板 (Supplier Portal)&quot;">​</a></h2><h3 id="企业痛点-3" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点-3" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p>“供应商不知道我用了多少货，天天打电话来问”。</p><h3 id="开发逻辑点-3" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点-3" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>消耗透明化</strong>: <ul><li>开发者需为供应商门户提供 <code>Consumption_Query_API</code>。</li><li><strong>PG 实现建议</strong>: 启用 <strong>行级安全 (RLS)</strong> 确保供应商通过 API 只能访问属于其自身的 VMI 消耗记录，无需在代码层编写繁琐的权限过滤。</li></ul></li><li><strong>自动对账确认</strong>: <ul><li>开发者可设计“供应商电子对账”流程。</li><li><strong>PG 实现建议</strong>: 使用 <strong>JSON Schema 校验</strong> 对供应商上传的电子对账单进行结构化验证，确保数据导入的准确性。</li></ul></li></ul><hr><h2 id="_5-开发者-checklist" tabindex="-1">5. 开发者 Checklist <a class="header-anchor" href="#_5-开发者-checklist" aria-label="Permalink to &quot;5. 开发者 Checklist&quot;">​</a></h2><ul><li>[ ] <strong>高精度计算</strong>: 涉及结算金额的计算是否统一使用 <strong><code>numeric</code></strong>？</li><li>[ ] <strong>数据安全</strong>: 敏感的价格协议是否通过 <strong>RLS</strong> 进行了严格的权限控制？</li><li>[ ] <strong>性能优化</strong>: 对 VMI 消耗流水表是否建立了基于 <code>(supplier_id, settle_status)</code> 的 <strong>部分索引 (Partial Index)</strong>？</li><li>[ ] <strong>审计追踪</strong>: 是否利用 <strong><code>JSONB</code></strong> 记录了结算规则变更的历史快照？</li></ul>',30)])])}const m=r(n,[["render",i]]);export{h as __pageData,m as default};
