# 料品主数据 (Item Master) - 开发者详尽指南

## 概述
料品（Item）是 ERP 系统的“细胞”。在开发者眼中，它可能只是一个 `ItemCode`，但在业务中，它包含了**物理属性**、**计划参数**、**成本逻辑**和**质检要求**。一个料品属性的配置错误（如：忘记勾选“可委外”），会导致后续价值链上的所有单据报错。

---

## 1. 料品分类与编码 (Classification & Coding)

### 企业痛点
“一物多码”是所有制造企业的噩梦。采购部叫它“螺丝”，工程部叫它“M6自攻钉”。开发者如果只提供简单的 CRUD，而不考虑**别名映射**和**全局唯一性校验**，系统运行半年后基础数据就会变垃圾场。

### 开发逻辑点
- **编码规则引擎**: 严禁让用户手工录入主键。开发者需实现一套“编码生成器”，支持：`分类前缀 + 日期 + 流水号`。
- **别名管理**: 建立 `ItemAlias` 表，支持按供应商料号、客户料号进行快速检索。
- **全局共享**: U9 采用“私有+分配”模式。料品在集团中心维护，分配给不同工厂使用。开发者在查询时必须关联 `OrgAssignment` 表，确保用户只能看到本工厂合法的料品。

---

## 2. 计量单位与精密换算 (UOM & Conversion)

### 企业痛点
**“1吨钢材出库后，变成了 0.9999 吨”**。这是开发者最容易犯的错误——使用浮点数或不正确的换算时机。

### 核心模型
- **主单位 (Base UOM)**: 库存结存的唯一单位。
- **业务单位 (Business UOM)**: 采购（千克）、销售（卷）、生产（米）。
- **换算率**: `业务单位 = 主单位 * 换算率`。

### 开发逻辑点
- **精度控制**: 
    - 换算率必须支持 8 位以上小数。
    - **重要**: 所有的计算必须以“主单位”为基准。在单据保存时，必须同时持久化 `Quantity` (业务单位) 和 `BaseQuantity` (主单位)，防止汇率/换算率变动导致历史库存对不上。
- **双单位/二次计量**: 针对农产品或化工品（如：按“件”入库，按“公斤”结算），开发者需设计 `SecondQty` 字段，并在财务接口中明确哪个是“计价单位”。

---

## 3. 计划与供应属性 (Planning Parameters)

### 企业痛点
为什么 MRP 算出来要买 100 万个螺丝？可能仅仅是因为料品的“最小起订量 (MOQ)”设错了。

### 核心字段
- **供应方式**: 
    - `Buy`: 触发采购申请。
    - `Make`: 触发生产订单。
    - `Subcontract`: 触发委外订单。
- **虚设件 (Phantom)**: 仅作为 BOM 结构，不产生库存。开发者在做库存扣减逻辑时，必须实现“递归穿透”，跳过虚设件扣减其子件库存。
- **提前期 (Lead Time)**: 固定提前期、变动提前期。开发者在计算“建议到货日期”时，必须使用此参数反推。

---

## 4. 批次与序列号 (Lot & SN Control)

### 企业痛点
汽车、医药行业要求**全追溯**。如果这批药出问题了，必须立刻查出是哪天、哪个供应商提供的原材料。

### 开发逻辑点
- **强控制开关**: 料品主档应有 `IsLotControl` 和 `IsSNControl` 开关。
- **业务埋点**: 在 `InvTrans` (库存交易) 逻辑中，如果开关开启，`LotID` 必须必输。
- **先进先出 (FIFO)**: 开发者在实现“自动分配库位”逻辑时，应根据 `Lot.CreateDate` 进行升序排列建议。

---

## 5. 开发者 Checklist

- [ ] **索引优化**: `ItemCode` 和 `BarCode` 必须建立唯一索引。
- [ ] **级联校验**: 删除/停用料品前，必须检查是否存在未结案的订单（PO/SO/MO）。
- [ ] **属性扩展**: 采用 EAV 模式或 JSON 字段存储行业特有属性（如：服装的颜色/尺码）。
- [ ] **状态机**: 严格控制状态转换（申请中 -> 使用中 -> 呆滞 -> 停用），不同状态下对单据的录入权限需在后端强校验。
