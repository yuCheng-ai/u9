import{_ as i,c as a,o as t,ae as n}from"./chunks/framework.CDjunVez.js";const E=JSON.parse('{"title":"采购执行 (PO Execution) - 开发者详尽指南","description":"","frontmatter":{},"headers":[],"relativePath":"modules/scm/pur-process.md","filePath":"modules/scm/pur-process.md"}'),l={name:"modules/scm/pur-process.md"};function e(h,s,k,p,r,d){return t(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="采购执行-po-execution-开发者详尽指南" tabindex="-1">采购执行 (PO Execution) - 开发者详尽指南 <a class="header-anchor" href="#采购执行-po-execution-开发者详尽指南" aria-label="Permalink to &quot;采购执行 (PO Execution) - 开发者详尽指南&quot;">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>采购执行是企业“花钱”的过程。在 ERP 开发中，采购单（PO）必须具备<strong>全链路闭环</strong>与<strong>严密的版本控制</strong>。每一张 PO 都是需求（PR/MRP）、物流（Receipt）与财务（AP）的交汇点。开发者应利用 PostgreSQL 的<strong>版本化存储</strong>、<strong>精确数值计算</strong>和<strong>建议锁</strong>，确保资金流向的每一分钱都可追溯。</p><hr><h2 id="业务痛点与开发对策" tabindex="-1">业务痛点与开发对策 <a class="header-anchor" href="#业务痛点与开发对策" aria-label="Permalink to &quot;业务痛点与开发对策&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">业务痛点</th><th style="text-align:left;">技术对策</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>盲目采购</strong>：PR（申请）到 PO（订单）过程脱节，预算失控。</td><td style="text-align:left;"><strong>需求池锁定 (PR_Pool_Lock)</strong>：在 PR 转 PO 的原子事务中，通过 <code>FOR UPDATE</code> 锁定申请行，防止重复转化与超量下单。</td></tr><tr><td style="text-align:left;"><strong>变更无痕</strong>：PO 修改后，供应商和财务看到的版本不一致。</td><td style="text-align:left;"><strong>JSONB 全文快照</strong>：禁止原地修改已核准单据。变更时生成新版本，并利用 <code>jsonb_diff</code> 记录字段级变动足迹。</td></tr><tr><td style="text-align:left;"><strong>超收/乱收</strong>：供应商多发货，仓库照单全收，导致库存积压。</td><td style="text-align:left;"><strong>容差校验引擎</strong>：在收货 API 强制执行 <code>numeric(24,12)</code> 精度的 <code>qty_ordered * (1 + tolerance_rate)</code> 阈值拦截。</td></tr><tr><td style="text-align:left;"><strong>质量争议</strong>：货收了但质量不合格，财务却已走付款流程。</td><td style="text-align:left;"><strong>IQC 状态机协同</strong>：入库单行项目需挂接 <code>inspect_status</code>。只有状态为 <code>Passed</code> 的行才能被 AEP 引擎抛送到应付账簿。</td></tr></tbody></table><hr><h2 id="_1-采购需求池与版本化-pr-revision" tabindex="-1">1. 采购需求池与版本化 (PR &amp; Revision) <a class="header-anchor" href="#_1-采购需求池与版本化-pr-revision" aria-label="Permalink to &quot;1. 采购需求池与版本化 (PR &amp; Revision)&quot;">​</a></h2><h3 id="业务场景" tabindex="-1">业务场景 <a class="header-anchor" href="#业务场景" aria-label="Permalink to &quot;业务场景&quot;">​</a></h3><p>采购申请（PR）是所有采购行为的起点。由于生产计划（MRP）的波动，PR 可能会频繁调整。</p><h3 id="开发规范" tabindex="-1">开发规范 <a class="header-anchor" href="#开发规范" aria-label="Permalink to &quot;开发规范&quot;">​</a></h3><ul><li><strong>全量版本化 (Full Versioning)</strong>: 采购申请 (PR) 与 采购订单 (PO) 必须支持版本追踪。</li><li><strong>禁止物理删除</strong>: 任何变更必须通过“版本升迁”实现，旧版本进入 <code>pur_order_history</code>。</li><li><strong>技术实现建议</strong>: <ul><li>利用 <code>JSONB</code> 存储单据快照，确保变更前后可进行差异对比（Diff）。</li><li><strong>示例代码</strong>:<div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 记录 PO 变更历史</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pur_order_history (po_id, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">snapshot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, to_jsonb(pur_order.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pur_order </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :id;</span></span></code></pre></div></li></ul></li></ul><hr><h2 id="_2-采购需求池锁定与转化-pr-to-po-conversion" tabindex="-1">2. 采购需求池锁定与转化 (PR-to-PO Conversion) <a class="header-anchor" href="#_2-采购需求池锁定与转化-pr-to-po-conversion" aria-label="Permalink to &quot;2. 采购需求池锁定与转化 (PR-to-PO Conversion)&quot;">​</a></h2><h3 id="业务场景-1" tabindex="-1">业务场景 <a class="header-anchor" href="#业务场景-1" aria-label="Permalink to &quot;业务场景&quot;">​</a></h3><p>防止“零散采购”导致的成本上升。系统需支持将多个 PR 合并为一张 PO，并确保需求来源（PR）与执行（PO）的强关联。</p><h3 id="开发逻辑-需求池锁定-requirement-pooling" tabindex="-1">开发逻辑：需求池锁定 (Requirement Pooling) <a class="header-anchor" href="#开发逻辑-需求池锁定-requirement-pooling" aria-label="Permalink to &quot;开发逻辑：需求池锁定 (Requirement Pooling)&quot;">​</a></h3><ul><li><strong>原子化转化</strong>: 在 PR 生成 PO 的存储过程中，必须锁定 PR 行。</li><li><strong>示例代码</strong>:<div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- PR 转 PO 的核心事务片段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BEGIN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 1. 锁定并校验 PR 行（防止他人同时转化）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pur_req_line </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (:pr_line_ids) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AND</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Approved&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (qty </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qty_ordered) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FOR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 2. 插入 PO 头与行，并回填 PR 的已订货数量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pur_req_line </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qty_ordered </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qty_ordered </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :convert_qty,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CASE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WHEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (qty_ordered </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :convert_qty) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> qty </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">THEN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Closed&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ELSE</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Partial&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> END</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :pr_line_id;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COMMIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div></li></ul><hr><h2 id="_3-po-版本管理与变更控制-jsonb-snapshots" tabindex="-1">3. PO 版本管理与变更控制 (JSONB Snapshots) <a class="header-anchor" href="#_3-po-版本管理与变更控制-jsonb-snapshots" aria-label="Permalink to &quot;3. PO 版本管理与变更控制 (JSONB Snapshots)&quot;">​</a></h2><h3 id="业务场景-2" tabindex="-1">业务场景 <a class="header-anchor" href="#业务场景-2" aria-label="Permalink to &quot;业务场景&quot;">​</a></h3><p>已下达给供应商的订单，任何价格或数量的修改都可能引发法律风险。</p><h3 id="技术实现建议" tabindex="-1">技术实现建议 <a class="header-anchor" href="#技术实现建议" aria-label="Permalink to &quot;技术实现建议&quot;">​</a></h3><ul><li><strong>禁止原地更新</strong>: 如果 <code>status = &#39;Approved&#39;</code>，更新操作应被触发器（Trigger）拦截，引导用户走“变更申请（CO）”。</li><li><strong>版本快照</strong>: 每次核准时，将单据全量转为 JSONB 存入 <code>pur_order_history</code>。</li><li><strong>差异审计</strong>:<div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 利用 jsonb_each_text 对比版本差异</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  old</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> field_name, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  old</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> original_val, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> current_val</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jsonb_each_text(:old_snapshot) old</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FULL OUTER JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jsonb_each_text(:new_snapshot) new </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> old</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">key</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> old</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> IS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DISTINCT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div></li></ul><hr><h2 id="_4-受控收货与容差校验-tolerance-engine" tabindex="-1">4. 受控收货与容差校验 (Tolerance Engine) <a class="header-anchor" href="#_4-受控收货与容差校验-tolerance-engine" aria-label="Permalink to &quot;4. 受控收货与容差校验 (Tolerance Engine)&quot;">​</a></h2><h3 id="业务场景-3" tabindex="-1">业务场景 <a class="header-anchor" href="#业务场景-3" aria-label="Permalink to &quot;业务场景&quot;">​</a></h3><p>采购 100 吨钢材，供应商发了 101 吨。企业通常允许 5% 以内的误差。</p><h3 id="开发规范-1" tabindex="-1">开发规范 <a class="header-anchor" href="#开发规范-1" aria-label="Permalink to &quot;开发规范&quot;">​</a></h3><ul><li><strong>容差逻辑</strong>: <code>ReceivedQty &lt;= OrderedQty * (1 + UpperTolerance)</code>。</li><li><strong>精度陷阱</strong>: 严禁使用 <code>float/double</code>。必须使用 <code>numeric</code> 类型进行乘法运算后再对比。</li><li><strong>示例代码</strong>:<div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 收货接口中的硬核校验</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  CASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    WHEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :receive_qty </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">l</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">qty</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> l</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">upper_tolerance_rate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">THEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      RAISE EXCEPTION </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ERR_OVER_RECEIPT: 收货数量超过订单允许的最大容差范围&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  END</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pur_order_line l </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> l</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :po_line_id;</span></span></code></pre></div></li></ul><hr><h2 id="_5-iqc-协同与质量追溯-quality-gates" tabindex="-1">5. IQC 协同与质量追溯 (Quality Gates) <a class="header-anchor" href="#_5-iqc-协同与质量追溯-quality-gates" aria-label="Permalink to &quot;5. IQC 协同与质量追溯 (Quality Gates)&quot;">​</a></h2><h3 id="业务场景-4" tabindex="-1">业务场景 <a class="header-anchor" href="#业务场景-4" aria-label="Permalink to &quot;业务场景&quot;">​</a></h3><p>物料入库后处于“待检”状态，不能立即被领用，且不能进行财务结算。</p><h3 id="开发逻辑" tabindex="-1">开发逻辑 <a class="header-anchor" href="#开发逻辑" aria-label="Permalink to &quot;开发逻辑&quot;">​</a></h3><ul><li><strong>库存状态隔离</strong>: 收货后，库存记录的 <code>is_available</code> 标记设为 <code>false</code>，<code>status</code> 设为 <code>Wait_Inspect</code>。</li><li><strong>财务对账关口</strong>: AEP 凭证生成引擎在扫描入库单时，必须过滤 <code>inspect_status = &#39;Passed&#39;</code> 的记录。</li><li><strong>追溯链条</strong>: 入库批次（Lot）必须物理存储 <code>po_id</code> 和 <code>vendor_id</code>，实现从成品缺陷到供应商原材料的秒级回溯。</li></ul><hr><h2 id="_6-开发者-checklist" tabindex="-1">6. 开发者 Checklist <a class="header-anchor" href="#_6-开发者-checklist" aria-label="Permalink to &quot;6. 开发者 Checklist&quot;">​</a></h2><ul><li>[ ] <strong>数值精度</strong>: 采购单位换算、单价计算是否使用了 <code>numeric(24, 12)</code>？</li><li>[ ] <strong>需求闭环</strong>: PR 行的 <code>qty_ordered</code> 回填是否在同一事务内完成，并处理了超订货校验？</li><li>[ ] <strong>变更升版</strong>: 已核准单据的修改是否强制触发了版本快照记录？</li><li>[ ] <strong>质量关口</strong>: 入库单是否支持检验策略判断？未检物资是否正确设置了库存可用性标记？</li><li>[ ] <strong>反审核拦截</strong>: PO 已产生入库单或发票时，是否在后端代码级禁止了弃审操作？</li><li>[ ] <strong>多币种处理</strong>: 涉及外币采购时，是否在单据行记录了交易汇率（TransRate）与本币金额（LocalAmount）？</li><li>[ ] <strong>建议锁</strong>: 在进行大批量 PR 聚合时，是否使用了 <code>pg_advisory_xact_lock</code> 防止死锁？</li></ul>`,39)])])}const g=i(l,[["render",e]]);export{E as __pageData,g as default};
