# BOM 维护与多版本控制 (BOM)

## 概述
物料清单（BOM）不仅仅是产品的零件清单，它是 ERP 制造、计划、成本、采购的“灵魂”。U9 级的 BOM 体系支持复杂的离散制造场景，涵盖从工程设计到量产的全生命周期。

## 1. BOM 类型与用途
支持多维度的 BOM 定义，满足不同业务部门的需求：
- **生产 BOM (Production)**: 实际下达生产订单、备料和领料的依据。
- **规划 BOM (Planning)**: 用于 MPS/MRP 预测展开，支持虚设件（Phantom）处理。
- **成本 BOM (Costing)**: 专门用于标准成本卷积，可包含不同的损耗率设置。
- **委外 BOM (Subcontracting)**: 针对委外加工场景，定义发料清单。

## 2. 核心属性与精细化控制

### 2.1 子件属性 (Component Attributes)
- **供应类型**: 
  - **推式 (Push)**: 手动领料。
  - **拉式 (Pull)**: 倒冲领料（Backflush），基于完工汇报自动扣减库存。
  - **虚设件 (Phantom)**: 逻辑件，不产生库存，MRP 运算时自动穿透到下一层。
- **产出类型**: 
  - **主产品**: 核心产出。
  - **联产品 (Co-product)**: 同时产出的高价值产品，参与成本分摊。
  - **副产品 (By-product)**: 附带产出的低价值物料。

### 2.2 损耗与用量
- **固定损耗 vs. 变动损耗**: 
  - 固定损耗：不论生产多少，开机必损。
  - 变动损耗：按产量比例损耗。
- **产出率**: 控制成品的得料率。

## 3. 替代料逻辑 (Substitution)
U9 的替代逻辑支持多层级、多场景：
- **物料级替代**: 料品 A 长期替代 B。
- **BOM 级替代**: 在产品 X 的生产中，A 可以替代 B。
- **组替代**: 
  - **全组替代**: 必须整组物料一起替换。
  - **优先级替代**: 按 1, 2, 3 优先级自动匹配可用库存。

## 4. 生命周期与版本管理

### 4.1 状态控制
- **新建 (Draft)**: 正在编辑。
- **核准 (Approved)**: 可用于计划，但不能用于生产。
- **发布 (Released)**: 正式量产状态。
- **停用 (Obsolete)**: 历史版本，不可再用。

### 4.2 时间轴控制
- **生效日期/失效日期**: 精确到秒，支持“期初切入”和“期末切出”逻辑。
- **工程变更 (ECN) 驱动**: 所有的 BOM 修改必须挂钩 ECN 单号，记录“为何改、谁改的、改了哪”。

## 7. BOM 的查询与展现模式
在 ERP 实际操作中，为了满足不同场景的分析需求，BOM 支持多种展现模式：

### 7.1 单阶 BOM (Single-Level BOM)
- **定义**: 仅显示父项与其直接子项的关系。
- **场景**: 生产车间领料、简单的父子关系维护。

### 7.2 全阶 BOM / 缩进 BOM (Indented/Multi-Level BOM)
- **定义**: 从顶层成品开始，递归展开所有层级的半成品、零件，直到最底层的原材料。
- **展现形式**: 通常以树状结构或带缩进的列表展现。
- **价值**: 
  - **全图视角**: 研发和工艺人员查看产品的完整构成。
  - **影响分析**: 当底层某个螺丝钉短缺时，通过全阶反查可以快速锁定影响了哪些成品。

### 7.3 汇总 BOM (Summarized BOM)
- **定义**: 不考虑层级，将全阶范围内所有相同的物料用量进行累加汇总。
- **场景**: 采购部门一次性统计某个项目总共需要买多少吨钢材。

## 8. 核心运算逻辑：低阶码 (LLC)
- **逻辑点**: 系统在保存 BOM 或运行 MRP 前，会自动计算每个料品的“低阶码”。
- **目的**: 确保 MRP 引擎在计算需求时，总是先计算顶层，再逐层向下，避免递归循环，并保证底层料品的需求能被完整归集。

## 6. 与 PLM 的集成
- **同步机制**: 支持从 Teamcenter/Windchill 等 PLM 系统自动导入 E-BOM，并转换为 M-BOM。
- **差异比对**: 自动识别 PLM 变更，提示生产部门更新现有的生产订单。
