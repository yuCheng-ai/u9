# MRP/MPS 运算与平衡 (Planning)

## 概述
MRP（物料需求计划）是 ERP 的核心大脑。U9 的 MRP 引擎支持多方案并行模拟、多组织协同运算，能够处理海量的供需数据，实现“按需供应、精准排产”。

## 1. 计划层级：MPS vs. MRP
- **MPS (主生产计划)**: 
  - **对象**: 独立需求件（如成品、关键半成品、长周期采购件）。
  - **目的**: 稳定生产计划，通过对关键资源的粗能力核算（RCCP），确保顶层计划的可行性。
- **MRP (物料需求计划)**: 
  - **对象**: 相关需求件（组件、原材料）。
  - **目的**: 基于 MPS 的结果，结合 BOM 结构和库存状态，计算具体的采购和生产指令。

## 2. 核心运算逻辑：供需平衡

### 2.1 需求来源 (Demands)
- 销售订单 (SO)
- 销售预测 (Forecast)
- 生产订单备料需求
- 安全库存需求

### 2.2 供给来源 (Supplies)
- 现有库存 (On-hand)
- 在途采购单 (PO)
- 在制生产订单 (MO)
- 调拨入库单

### 2.3 平衡公式
`净需求 = (毛需求 + 安全库存) - (现有库存 + 预计入库 - 预计出库 - 已分配量)`

## 3. 关键参数与控制

### 3.1 预置时间 (Lead Time)
- **累计提前期**: 考虑所有子件采购和加工的总时间。
- **固定提前期 vs. 变动提前期**: 考虑批量对生产周期的影响。

### 3.2 批量规则 (Lot Sizing)
- **按需 (Lot-for-Lot)**: 缺多少补多少。
- **固定批量**: 每次补货必须是 N 的倍数。
- **期间汇总**: 将未来 N 天的需求合并为一个建议单。

## 4. 计划方案与模拟
- **多方案对比**: 可以建立“乐观”、“保守”、“基准”三种计划方案，模拟不同市场环境下的排产结果。
- **全再生 (Regeneration) vs. 净变 (Net Change)**: 
  - **全再生**: 清除旧计划，重新计算全局数据。
  - **净变**: 仅计算发生数据变动（如 SO 增加、BOM 修改）的部分，提高运算效率。

## 5. 计划输出：建议单 (Action Messages)
- **新建建议**: 建议生成采购单或生产单。
- **取消建议**: 需求已消失，建议取消在途订单。
- **提前/推迟建议**: 需求日期变动，建议调整现有单据的到货时间。
