import{_ as i,c as a,o as t,ae as l}from"./chunks/framework.CDjunVez.js";const g=JSON.parse('{"title":"项目制造 (PJM) - 开发者详尽指南","description":"","frontmatter":{},"headers":[],"relativePath":"modules/feature/pjm.md","filePath":"modules/feature/pjm.md"}'),n={name:"modules/feature/pjm.md"};function e(h,s,r,k,o,p){return t(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="项目制造-pjm-开发者详尽指南" tabindex="-1">项目制造 (PJM) - 开发者详尽指南 <a class="header-anchor" href="#项目制造-pjm-开发者详尽指南" aria-label="Permalink to &quot;项目制造 (PJM) - 开发者详尽指南&quot;">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>项目制造（Project Manufacturing）是 ERP 里的“特种作战”。开发者必须理解：在 PJM 模式下，<strong>项目号 (Project_ID)</strong> 是比料号更高的维度。每一颗螺丝钉、每一分钱的成本都必须打上项目的烙印，实现“专料专用、专款专用”。</p><hr><h2 id="_1-项目-四算-体系与预算控制-project-budgeting" tabindex="-1">1. 项目“四算”体系与预算控制 (Project Budgeting) <a class="header-anchor" href="#_1-项目-四算-体系与预算控制-project-budgeting" aria-label="Permalink to &quot;1. 项目“四算”体系与预算控制 (Project Budgeting)&quot;">​</a></h2><h3 id="企业痛点" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p><strong>“项目做完了，财务才发现超支了 20%，根本不知道钱花在哪了”</strong>。</p><h3 id="开发逻辑点" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>四算数据链</strong>: <ul><li>开发者需构建 <code>概算 (Estimation) -&gt; 预算 (Budget) -&gt; 核算 (Actual) -&gt; 决算 (Closing)</code> 的闭环。</li></ul></li><li><strong>实时预警接口</strong>: <ul><li>开发者需在采购（PO）和领料（Issue）API 中接入 <code>PJM_Budget_Check</code>。</li><li><strong>逻辑</strong>: <code>IF (Project_Actual + Current_Apply &gt; Project_Budget) THEN SET Status = &#39;Warning/Block&#39;</code>。</li></ul></li><li><strong>动态决算引擎</strong>: <ul><li>开发者需实现“完工百分比 (POC)”算法。</li><li><strong>公式</strong>: <code>POC = 实际发生额 / 预计总成本</code>。根据 POC 自动触发收入确认凭证。</li></ul></li><li><strong>技术实现建议</strong>: <ul><li>使用 PostgreSQL 的 <strong>Window Functions</strong> 实时计算项目各阶段的累计支出，无需存储中间统计表，确保数据实时性。</li><li>使用 <code>JSONB</code> 存储不同项目的个性化预算控制规则（如：某些项目允许超支 5%，某些严禁超支）。</li><li><strong>示例代码</strong>:<div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 使用窗口函数计算项目累计支出与预算执行率</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> project_id, budget_amt, </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(actual_amt) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OVER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PARTITION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> BY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> project_id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total_actual,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(actual_amt) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">OVER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">PARTITION</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> BY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> project_id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> budget_amt) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> execution_rate</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pjm_budget_ledger;</span></span></code></pre></div></li></ul></li></ul><hr><h2 id="_2-硬关联与软关联逻辑-hard-soft-pegging" tabindex="-1">2. 硬关联与软关联逻辑 (Hard/Soft Pegging) <a class="header-anchor" href="#_2-硬关联与软关联逻辑-hard-soft-pegging" aria-label="Permalink to &quot;2. 硬关联与软关联逻辑 (Hard/Soft Pegging)&quot;">​</a></h2><h3 id="企业痛点-1" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点-1" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p>“项目 A 的货到了，结果被项目 B 的领料员顺手领走了，导致项目 A 停工待料”。</p><h3 id="开发逻辑点-1" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点-1" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>硬关联 (Hard Pegging)</strong>: <ul><li>开发者需在库存表（Stock）中强制增加 <code>Project_ID</code> 索引字段。</li><li><strong>逻辑拦截</strong>: <code>WIP_Issue_API</code> 必须校验 <code>Demand.Project_ID == Stock.Project_ID</code>。如果不匹配，严禁出库。</li></ul></li><li><strong>虚拟项目池 (Project Pool)</strong>: <ul><li>对于通用件，开发者可设计“虚拟项目 000”。</li><li><strong>逻辑</strong>: 当特定项目缺货时，允许自动从“000 池”进行 <code>Stock_Reassignment</code>（库存重分配）。</li></ul></li><li><strong>技术实现建议</strong>: <ul><li>利用 PostgreSQL 的 <strong>Advisory Locks (咨询锁)</strong> 确保跨项目的库存借调/重分配操作的原子性，防止并发下的库存超扣。</li><li>为 <code>(item_id, project_id, lot_id)</code> 复合字段建立 <strong>B-Tree 索引</strong>，提升专料专用的库存查询效率。</li></ul></li></ul><hr><h2 id="_3-项目借调与成本补偿-project-borrowing" tabindex="-1">3. 项目借调与成本补偿 (Project Borrowing) <a class="header-anchor" href="#_3-项目借调与成本补偿-project-borrowing" aria-label="Permalink to &quot;3. 项目借调与成本补偿 (Project Borrowing)&quot;">​</a></h2><h3 id="企业痛点-2" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点-2" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p><strong>“项目 A 借了项目 B 的料，财务账怎么平？以后怎么还？”</strong>。</p><h3 id="开发逻辑点-2" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点-2" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>借调事务处理器 (Borrow/Loan Handler)</strong>: <ul><li>开发者需设计 <code>Project_Transfer_Doc</code>。</li><li><strong>财务逻辑</strong>: <ul><li>借出方：<code>DR 待补偿项目款 (Org_A) CR 库存 (Project_B)</code>。</li><li>借入方：<code>DR 库存 (Project_A) CR 待支付项目款 (Org_B)</code>。</li></ul></li></ul></li><li><strong>归还提醒 Job</strong>: <ul><li>开发者需写一个 Job，当项目 A 的补货采购单到货时，自动弹出“归还项目 B”的提醒。</li></ul></li><li><strong>技术实现建议</strong>: <ul><li>使用 PostgreSQL 的 <strong>SKIP LOCKED</strong> 特性实现高性能的“归还提醒”后台任务扫描，支持多节点并发处理而不会发送重复提醒。</li><li>使用 <code>JSONB</code> 记录借调时的成本快照，确保归还时按原价冲回，不受后续价格波动影响。</li></ul></li></ul><hr><h2 id="_4-wbs-任务分解与排程-wbs-integration" tabindex="-1">4. WBS 任务分解与排程 (WBS Integration) <a class="header-anchor" href="#_4-wbs-任务分解与排程-wbs-integration" aria-label="Permalink to &quot;4. WBS 任务分解与排程 (WBS Integration)&quot;">​</a></h2><h3 id="企业痛点-3" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点-3" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p>“项目计划在 Excel 里，生产计划在 ERP 里，两边根本对不上”。</p><h3 id="开发逻辑点-3" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点-3" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>WBS 与 MO 联动</strong>: <ul><li>开发者需实现 WBS 节点与生产订单 (MO) 的 <code>1:N</code> 关联。</li><li><strong>逻辑</strong>: WBS 节点的 <code>Start_Date</code> 自动约束 MO 的 <code>Earliest_Start_Date</code>。</li></ul></li><li><strong>进度自动反馈</strong>: <ul><li>开发者需确保 MO完工入库后，自动更新 WBS 任务的 <code>Progress_Percentage</code>。</li></ul></li><li><strong>技术实现建议</strong>: <ul><li>利用 PostgreSQL 的 <strong>Recursive CTE</strong> 处理无限层级的 WBS 结构查询，快速计算整个项目的总进度。</li><li>在 WBS 表上应用 <strong>Exclusion Constraints (排除约束)</strong>，防止同一项目下的关键资源在同一时间段被分配给多个冲突的任务。</li><li><strong>示例代码</strong>:<div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 递归计算 WBS 节点进度（按子节点权重加权平均）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WITH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> RECURSIVE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wbs_progress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id, parent_id, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, progress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> project_wbs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :root_node</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    UNION ALL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> w</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">w</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">parent_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">w</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">w</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">progress</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> project_wbs w</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wbs_progress p </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> w</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">parent_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(progress </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wbs_progress;</span></span></code></pre></div></li></ul></li></ul><hr><h2 id="_5-开发者-checklist" tabindex="-1">5. 开发者 Checklist <a class="header-anchor" href="#_5-开发者-checklist" aria-label="Permalink to &quot;5. 开发者 Checklist&quot;">​</a></h2><ul><li>[ ] <strong>多项目成本卷归</strong>: 一个 MO 同时为三个项目产出时，开发者是否实现了按 <code>BOM 比例</code> 或 <code>手动比例</code> 的成本拆分逻辑？</li><li>[ ] <strong>项目属性透传</strong>: 从 <code>销售订单 -&gt; LRP 计划 -&gt; 采购/生产 -&gt; 入库 -&gt; 出货</code>，开发者必须确保 <code>Project_ID</code> 在全链路单据中完整透传。</li><li>[ ] <strong>项目专用库位</strong>: 是否在仓库建模中支持了“项目库位”的自动过滤？</li><li>[ ] <strong>报表维度</strong>: 项目损益表是否能实时穿透到每一笔 <code>Project_Task</code> 级别的支出？</li></ul>`,30)])])}const c=i(n,[["render",e]]);export{g as __pageData,c as default};
