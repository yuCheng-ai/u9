import{_ as r,c as a,o as e,ae as t}from"./chunks/framework.CDjunVez.js";const h=JSON.parse('{"title":"货源管理与配额分配 - 开发者详尽指南","description":"","frontmatter":{},"headers":[],"relativePath":"modules/scm/pur-source.md","filePath":"modules/scm/pur-source.md"}'),l={name:"modules/scm/pur-source.md"};function n(i,o,s,d,c,g){return e(),a("div",null,[...o[0]||(o[0]=[t('<h1 id="货源管理与配额分配-开发者详尽指南" tabindex="-1">货源管理与配额分配 - 开发者详尽指南 <a class="header-anchor" href="#货源管理与配额分配-开发者详尽指南" aria-label="Permalink to &quot;货源管理与配额分配 - 开发者详尽指南&quot;">​</a></h1><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><p>货源管理（Sourcing）是采购的“导航系统”。开发者必须理解：货源决定了**“向谁买”<strong>以及</strong>“买多少”<strong>。在高并发的 MRP 运算中，货源逻辑必须是</strong>毫秒级自动判定**的。</p><hr><h2 id="_1-货源清单与优先级逻辑-approved-vendor-list" tabindex="-1">1. 货源清单与优先级逻辑 (Approved Vendor List) <a class="header-anchor" href="#_1-货源清单与优先级逻辑-approved-vendor-list" aria-label="Permalink to &quot;1. 货源清单与优先级逻辑 (Approved Vendor List)&quot;">​</a></h2><h3 id="企业痛点" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p><strong>“新来的采购员买错了供应商，买到了没通过质量体系认证的小作坊”</strong>。</p><h3 id="开发逻辑点" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>AVL 强控逻辑 (Approved Vendor List)</strong>: <ul><li>开发者需在所有采购类单据的 <code>Item_Change</code> 事件中增加拦截。</li><li><strong>PG 实现建议</strong>: 利用 PostgreSQL 的 <strong><code>CHECK</code> 约束</strong> 结合自定义函数，或者在单据保存的触发器中执行 AVL 校验，确保数据层面的绝对一致性。</li></ul></li><li><strong>有效期管理</strong>: <ul><li>货源关系必须有 <code>StartDate</code> 和 <code>EndDate</code>。</li><li><strong>PG 实现建议</strong>: 使用 <strong><code>daterange</code></strong> 类型存储货源有效期，并利用 <strong><code>EXCLUDE</code> 约束</strong> 防止同一物料在同一时间段内出现冲突的货源策略。</li></ul></li></ul><hr><h2 id="_2-配额比例分配算法-quota-allocation" tabindex="-1">2. 配额比例分配算法 (Quota Allocation) <a class="header-anchor" href="#_2-配额比例分配算法-quota-allocation" aria-label="Permalink to &quot;2. 配额比例分配算法 (Quota Allocation)&quot;">​</a></h2><h3 id="企业痛点-1" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点-1" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p>“我们要培养二供（备份供应商），要求 A 供应商占 70%，B 供应商占 30%，但手动算太麻烦，经常算错”。</p><h3 id="开发算法" tabindex="-1">开发算法 <a class="header-anchor" href="#开发算法" aria-label="Permalink to &quot;开发算法&quot;">​</a></h3><ul><li><strong>自动配额逻辑</strong>: <ul><li>开发者需在 MRP 建议转 PO 时，调用 <code>Quota_Split_Engine</code>。</li><li><strong>PG 实现建议</strong>: 利用 PostgreSQL 的 <strong>窗口函数 (Window Functions)</strong> 和 <strong><code>CUME_DIST</code></strong> 实现复杂的配额占比计算，避免在应用层进行大规模循环。</li></ul></li><li><strong>累计差异补偿</strong>: <ul><li>开发者需考虑“历史累计量”。</li><li><strong>PG 实现建议</strong>: 使用 <strong>物化视图 (Materialized Views)</strong> 预计算各供应商的累计供应量，并定期通过后台 Job 刷新，以支撑实时的配额补偿算法。</li></ul></li></ul><hr><h2 id="_3-跨组织货源协同-inter-org-sourcing" tabindex="-1">3. 跨组织货源协同 (Inter-Org Sourcing) <a class="header-anchor" href="#_3-跨组织货源协同-inter-org-sourcing" aria-label="Permalink to &quot;3. 跨组织货源协同 (Inter-Org Sourcing)&quot;">​</a></h2><h3 id="企业痛点-2" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点-2" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p><strong>“集团总部定好了供应商，下属工厂还得自己录一遍，效率太低”</strong>。</p><h3 id="开发逻辑点-1" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点-1" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>货源下发机制</strong>: <ul><li>开发者需设计“主数据推送”逻辑。</li><li><strong>PG 实现建议</strong>: 使用 PostgreSQL 的 <strong>逻辑复制 (Logical Decoding)</strong> 或 <strong><code>postgres_fdw</code></strong> 实现集团主数据到各工厂库的准实时同步。</li></ul></li><li><strong>组织特定偏置</strong>: <ul><li>开发者需允许工厂组织在继承集团货源的基础上增加偏置。</li><li><strong>PG 实现建议</strong>: 使用 <strong>继承表 (Table Inheritance)</strong> 结构，让工厂表继承集团主表字段，并增加工厂特有的属性字段（如 <code>Local_Lead_Time</code>）。</li></ul></li></ul><hr><h2 id="_4-供应商评分与货源准入-supplier-scorecard" tabindex="-1">4. 供应商评分与货源准入 (Supplier Scorecard) <a class="header-anchor" href="#_4-供应商评分与货源准入-supplier-scorecard" aria-label="Permalink to &quot;4. 供应商评分与货源准入 (Supplier Scorecard)&quot;">​</a></h2><h3 id="企业痛点-3" tabindex="-1">企业痛点 <a class="header-anchor" href="#企业痛点-3" aria-label="Permalink to &quot;企业痛点&quot;">​</a></h3><p>“某个供应商最近老是延迟交货，我们想自动减少他的配额”。</p><h3 id="开发逻辑点-2" tabindex="-1">开发逻辑点 <a class="header-anchor" href="#开发逻辑点-2" aria-label="Permalink to &quot;开发逻辑点&quot;">​</a></h3><ul><li><strong>动态评级接口</strong>: <ul><li>开发者需提供 <code>Update_Supplier_Rating</code> API。</li><li><strong>PG 实现建议</strong>: 使用 <strong><code>NOTIFY / LISTEN</code></strong> 机制。当供应商评分更新时，触发信号，自动重算受影响物料的配额分配权重。</li></ul></li><li><strong>准入工作流</strong>: <ul><li>货源记录的新增必须关联供应商考察单。</li><li><strong>PG 实现建议</strong>: 使用 <strong>JSONB</strong> 存储考察报告的结构化数据，方便在货源审批界面直接展示多维度的评估详情。</li></ul></li></ul><hr><h2 id="_5-开发者-checklist" tabindex="-1">5. 开发者 Checklist <a class="header-anchor" href="#_5-开发者-checklist" aria-label="Permalink to &quot;5. 开发者 Checklist&quot;">​</a></h2><ul><li>[ ] <strong>多租户隔离</strong>: 是否启用了 <strong>RLS</strong> 确保不同法人的货源清单相互隔离？</li><li>[ ] <strong>高精度占比</strong>: 配额比例计算是否使用了 <strong><code>numeric</code></strong> 类型以防止 100% 分配不尽的情况？</li><li>[ ] <strong>最小起订量 (MOQ)</strong>: 分配配额时，是否考虑了供应商的 MOQ？</li><li>[ ] <strong>审计记录</strong>: 是否利用 <strong><code>JSONB</code></strong> 记录了配额调整的完整轨迹和原因？</li></ul>',30)])])}const p=r(l,[["render",n]]);export{h as __pageData,p as default};
